"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform = require("platform");
var color_1 = require("color");
var application = require("application");
var utils = require("utils/utils");
try {
    var ArgonPrivate = require('argon-private');
}
catch (e) { }
application.on(application.orientationChangedEvent, function () {
    updateScreenOrientation();
    setTimeout(updateScreenOrientation, 100);
});
var iosSharedApplication;
function getNativeScreenOrientation() {
    if (application.ios) {
        iosSharedApplication = iosSharedApplication || utils.ios.getter(UIApplication, UIApplication.sharedApplication);
        var orientation = iosSharedApplication.statusBarOrientation;
        switch (orientation) {
            case 0 /* Unknown */:
            case 1 /* Portrait */: return 0;
            case 2 /* PortraitUpsideDown */: return 180;
            case 4 /* LandscapeLeft */: return 90;
            case 3 /* LandscapeRight */: return -90;
        }
    }
    if (application.android) {
        var context = utils.ad.getApplicationContext();
        var display = context.getSystemService(android.content.Context.WINDOW_SERVICE).getDefaultDisplay();
        var rotation = display.getRotation();
        switch (rotation) {
            case android.view.Surface.ROTATION_0: return 0;
            case android.view.Surface.ROTATION_180: return 180;
            case android.view.Surface.ROTATION_90: return 90;
            case android.view.Surface.ROTATION_270: return -90;
        }
    }
    return 0;
}
exports.screenOrientation = 0;
function updateScreenOrientation() {
    exports.screenOrientation = getNativeScreenOrientation();
}
function canDecrypt() {
    return !!ArgonPrivate;
}
exports.canDecrypt = canDecrypt;
function decrypt(encryptedData) {
    if (!ArgonPrivate)
        return Promise.reject(new Error("This build of Argon is incapable of decrypting messages."));
    return Promise.resolve().then(function () {
        return ArgonPrivate.decrypt(encryptedData);
    });
}
exports.decrypt = decrypt;
function getInternalVuforiaKey() {
    return ArgonPrivate && ArgonPrivate.getVuforiaLicenseKey();
}
exports.getInternalVuforiaKey = getInternalVuforiaKey;
function bringToFront(view) {
    if (view.android) {
        view.android.bringToFront();
    }
    else if (view.ios) {
        view.ios.superview.bringSubviewToFront(view.ios);
    }
}
exports.bringToFront = bringToFront;
function linearGradient(view, colors) {
    var _colors = [];
    var nativeView = view['_nativeView'];
    if (!nativeView) {
        return;
    }
    colors.forEach(function (c, idx) {
        if (!(c instanceof color_1.Color)) {
            colors[idx] = new color_1.Color(c);
        }
    });
    if (platform.device.os === platform.platformNames.android) {
        var backgroundDrawable = nativeView.getBackground(), LINEAR_GRADIENT = 0;
        colors.forEach(function (c) {
            _colors.push(c.android);
        });
        if (!(backgroundDrawable instanceof android.graphics.drawable.GradientDrawable)) {
            backgroundDrawable = new android.graphics.drawable.GradientDrawable();
            backgroundDrawable.setColors(_colors);
            backgroundDrawable.setGradientType(LINEAR_GRADIENT);
            nativeView.setBackgroundDrawable(backgroundDrawable);
        }
    }
    else if (platform.device.os === platform.platformNames.ios) {
        var iosView = view.ios;
        var colorsArray = NSMutableArray.alloc().initWithCapacity(2);
        colors.forEach(function (c) {
            colorsArray.addObject(interop.types.id(c.ios.CGColor));
        });
        var gradientLayer = CAGradientLayer.layer();
        gradientLayer.colors = colorsArray;
        gradientLayer.frame = iosView.bounds;
        iosView.layer.insertSublayerAtIndex(gradientLayer, 0);
    }
}
exports.linearGradient = linearGradient;
function ipToString(inAddr) {
    if (!inAddr) {
        throw new Error('in == NULL');
    }
    if (inAddr.s_addr === 0x00000000) {
        return '*';
    }
    else {
        return NSString.stringWithCStringEncoding(inet_ntoa(inAddr), 1).toString();
    }
}
function getIPAddressOfInterface($interface) {
    var address = '-';
    if (!$interface) {
        return address;
    }
    var interfacesPtrPtr = new interop.Reference();
    if (getifaddrs(interfacesPtrPtr) === 0) {
        var interfacesPtr = interfacesPtrPtr[0];
        var temp_addrPtr = interfacesPtr;
        while (temp_addrPtr != null) {
            if (temp_addrPtr[0].ifa_addr[0].sa_family === 2) {
                var name = NSString.stringWithUTF8String(temp_addrPtr[0].ifa_name).toString().trim();
                if (name == $interface) {
                    var ifa_addrPtr = temp_addrPtr[0].ifa_addr;
                    var ifa_addrPtrAsSockAddtr_in = new interop.Reference(sockaddr_in, ifa_addrPtr);
                    address = ipToString(ifa_addrPtrAsSockAddtr_in[0].sin_addr);
                }
            }
            temp_addrPtr = temp_addrPtr[0].ifa_next;
        }
        freeifaddrs(interfacesPtr);
    }
    return address;
}
exports.getIPAddressOfInterface = getIPAddressOfInterface;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxtQ0FBcUM7QUFDckMsK0JBQTRCO0FBQzVCLHlDQUEyQztBQUMzQyxtQ0FBcUM7QUFFckMsSUFBSSxDQUFDO0lBQ0gsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQztBQUVkLFdBQVcsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLHVCQUF1QixFQUFFO0lBQ2xELHVCQUF1QixFQUFFLENBQUM7SUFDMUIsVUFBVSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzNDLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxvQkFBa0MsQ0FBQztBQUV2QztJQUNJLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2xCLG9CQUFvQixHQUFHLG9CQUFvQixJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNoSCxJQUFNLFdBQVcsR0FBRyxvQkFBb0IsQ0FBQyxvQkFBb0IsQ0FBQztRQUM5RCxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLEtBQUssZUFBOEIsQ0FBQztZQUNwQyxLQUFLLGdCQUErQixFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSywwQkFBeUMsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDO1lBQzNELEtBQUsscUJBQW9DLEVBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNyRCxLQUFLLHNCQUFxQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUMzRCxDQUFDO0lBQ0wsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFD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LENBQUM7UUFDeEMsSUFBSSxZQUFZLEdBQUcsYUFBYSxDQUFDO1FBRWpDLE9BQU8sWUFBWSxJQUFJLElBQUksRUFBRSxDQUFDO1lBQzFCLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3JGLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNyQixJQUFJLFdBQVcsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO29CQUMzQyxJQUFJLHlCQUF5QixHQUFHLElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7b0JBQ2hGLE9BQU8sR0FBRyxVQUFVLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ2hFLENBQUM7WUFDTCxDQUFDO1lBQ0QsWUFBWSxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDNUMsQ0FBQztRQUVELFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNuQixDQUFDO0FBM0JELDBEQTJCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Vmlld30gZnJvbSBcInVpL2NvcmUvdmlld1wiO1xuaW1wb3J0ICogYXMgcGxhdGZvcm0gZnJvbSBcInBsYXRmb3JtXCI7XG5pbXBvcnQge0NvbG9yfSBmcm9tIFwiY29sb3JcIjtcbmltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gXCJhcHBsaWNhdGlvblwiO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAndXRpbHMvdXRpbHMnO1xuXG50cnkge1xuICB2YXIgQXJnb25Qcml2YXRlID0gcmVxdWlyZSgnYXJnb24tcHJpdmF0ZScpO1xufSBjYXRjaCAoZSkge31cblxuYXBwbGljYXRpb24ub24oYXBwbGljYXRpb24ub3JpZW50YXRpb25DaGFuZ2VkRXZlbnQsICgpPT57XG4gIHVwZGF0ZVNjcmVlbk9yaWVudGF0aW9uKCk7XG4gIHNldFRpbWVvdXQodXBkYXRlU2NyZWVuT3JpZW50YXRpb24sIDEwMCk7XG59KTtcblxubGV0IGlvc1NoYXJlZEFwcGxpY2F0aW9uOlVJQXBwbGljYXRpb247XG5cbmZ1bmN0aW9uIGdldE5hdGl2ZVNjcmVlbk9yaWVudGF0aW9uKCkge1xuICAgIGlmIChhcHBsaWNhdGlvbi5pb3MpIHtcbiAgICAgICAgaW9zU2hhcmVkQXBwbGljYXRpb24gPSBpb3NTaGFyZWRBcHBsaWNhdGlvbiB8fCB1dGlscy5pb3MuZ2V0dGVyKFVJQXBwbGljYXRpb24sIFVJQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24pO1xuICAgICAgICBjb25zdCBvcmllbnRhdGlvbiA9IGlvc1NoYXJlZEFwcGxpY2F0aW9uLnN0YXR1c0Jhck9yaWVudGF0aW9uO1xuICAgICAgICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIFVJSW50ZXJmYWNlT3JpZW50YXRpb24uVW5rbm93bjpcbiAgICAgICAgICAgIGNhc2UgVUlJbnRlcmZhY2VPcmllbnRhdGlvbi5Qb3J0cmFpdDogcmV0dXJuIDA7XG4gICAgICAgICAgICBjYXNlIFVJSW50ZXJmYWNlT3JpZW50YXRpb24uUG9ydHJhaXRVcHNpZGVEb3duOiByZXR1cm4gMTgwO1xuICAgICAgICAgICAgY2FzZSBVSUludGVyZmFjZU9yaWVudGF0aW9uLkxhbmRzY2FwZUxlZnQ6IHJldHVybiA5MDtcbiAgICAgICAgICAgIGNhc2UgVUlJbnRlcmZhY2VPcmllbnRhdGlvbi5MYW5kc2NhcGVSaWdodDogcmV0dXJuIC05MDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoYXBwbGljYXRpb24uYW5kcm9pZCkge1xuICAgICAgICBjb25zdCBjb250ZXh0OmFuZHJvaWQuY29udGVudC5Db250ZXh0ID0gdXRpbHMuYWQuZ2V0QXBwbGljYXRpb25Db250ZXh0KCk7XG4gICAgICAgIGNvbnN0IGRpc3BsYXk6YW5kcm9pZC52aWV3LkRpc3BsYXkgPSBjb250ZXh0LmdldFN5c3RlbVNlcnZpY2UoYW5kcm9pZC5jb250ZW50LkNvbnRleHQuV0lORE9XX1NFUlZJQ0UpLmdldERlZmF1bHREaXNwbGF5KCk7XG4gICAgICAgIGNvbnN0IHJvdGF0aW9uID0gZGlzcGxheS5nZXRSb3RhdGlvbigpO1xuICAgICAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzA6IHJldHVybiAwO1xuICAgICAgICAgICAgY2FzZSBhbmRyb2lkLnZpZXcuU3VyZmFjZS5ST1RBVElPTl8xODA6IHJldHVybiAxODA7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzkwOiByZXR1cm4gOTA7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzI3MDogcmV0dXJuIC05MDtcbiAgICAgICAgfVxuICAgIH0gXG4gICAgcmV0dXJuIDA7XG59XG5cbmV4cG9ydCBsZXQgc2NyZWVuT3JpZW50YXRpb246bnVtYmVyID0gMDtcblxuZnVuY3Rpb24gdXBkYXRlU2NyZWVuT3JpZW50YXRpb24oKSB7XG4gIHNjcmVlbk9yaWVudGF0aW9uID0gZ2V0TmF0aXZlU2NyZWVuT3JpZW50YXRpb24oKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbkRlY3J5cHQoKSA6IGJvb2xlYW4geyBcbiAgcmV0dXJuICEhQXJnb25Qcml2YXRlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVjcnlwdChlbmNyeXB0ZWREYXRhOnN0cmluZykgOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAoIUFyZ29uUHJpdmF0ZSkgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlRoaXMgYnVpbGQgb2YgQXJnb24gaXMgaW5jYXBhYmxlIG9mIGRlY3J5cHRpbmcgbWVzc2FnZXMuXCIpKVxuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKT0+e1xuICAgIHJldHVybiBBcmdvblByaXZhdGUuZGVjcnlwdChlbmNyeXB0ZWREYXRhKVxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEludGVybmFsVnVmb3JpYUtleSgpIDogc3RyaW5nfHVuZGVmaW5lZCB7XG4gIHJldHVybiBBcmdvblByaXZhdGUgJiYgQXJnb25Qcml2YXRlLmdldFZ1Zm9yaWFMaWNlbnNlS2V5KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBicmluZ1RvRnJvbnQodmlldzogVmlldykge1xuICBpZiAodmlldy5hbmRyb2lkKSB7XG4gICAgdmlldy5hbmRyb2lkLmJyaW5nVG9Gcm9udCgpO1xuICB9IGVsc2UgaWYgKHZpZXcuaW9zKSB7XG4gICAgdmlldy5pb3Muc3VwZXJ2aWV3LmJyaW5nU3Vidmlld1RvRnJvbnQodmlldy5pb3MpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsaW5lYXJHcmFkaWVudCh2aWV3OlZpZXcsIGNvbG9yczooQ29sb3J8c3RyaW5nKVtdKSB7XG4gIHZhciBfY29sb3JzOmFueVtdID0gW107XG4gIHZhciBuYXRpdmVWaWV3ID0gdmlld1snX25hdGl2ZVZpZXcnXTtcblxuICBpZiAoIW5hdGl2ZVZpZXcpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb2xvcnMuZm9yRWFjaChmdW5jdGlvbiAoYywgaWR4KSB7XG4gICAgaWYgKCEoYyBpbnN0YW5jZW9mIENvbG9yKSkge1xuICAgICAgY29sb3JzW2lkeF0gPSBuZXcgQ29sb3IoYyk7XG4gICAgfVxuICB9KTtcblxuICBpZiAocGxhdGZvcm0uZGV2aWNlLm9zID09PSBwbGF0Zm9ybS5wbGF0Zm9ybU5hbWVzLmFuZHJvaWQpIHtcbiAgICB2YXIgYmFja2dyb3VuZERyYXdhYmxlID0gbmF0aXZlVmlldy5nZXRCYWNrZ3JvdW5kKCksXG4gICAgICBMSU5FQVJfR1JBRElFTlQgPSAwO1xuXG4gICAgY29sb3JzLmZvckVhY2goZnVuY3Rpb24gKGM6Q29sb3IpIHtcbiAgICAgIF9jb2xvcnMucHVzaChjLmFuZHJvaWQpO1xuICAgIH0pO1xuXG4gICAgaWYgKCEoYmFja2dyb3VuZERyYXdhYmxlIGluc3RhbmNlb2YgYW5kcm9pZC5ncmFwaGljcy5kcmF3YWJsZS5HcmFkaWVudERyYXdhYmxlKSkge1xuICAgICAgYmFja2dyb3VuZERyYXdhYmxlID0gbmV3IGFuZHJvaWQuZ3JhcGhpY3MuZHJhd2FibGUuR3JhZGllbnREcmF3YWJsZSgpO1xuICAgICAgYmFja2dyb3VuZERyYXdhYmxlLnNldENvbG9ycyhfY29sb3JzKTtcbiAgICAgIGJhY2tncm91bmREcmF3YWJsZS5zZXRHcmFkaWVudFR5cGUoTElORUFSX0dSQURJRU5UKTtcbiAgICAgIG5hdGl2ZVZpZXcuc2V0QmFja2dyb3VuZERyYXdhYmxlKGJhY2tncm91bmREcmF3YWJsZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHBsYXRmb3JtLmRldmljZS5vcyA9PT0gcGxhdGZvcm0ucGxhdGZvcm1OYW1lcy5pb3MpIHtcbiAgICB2YXIgaW9zVmlldzpVSVZpZXcgPSB2aWV3LmlvcztcbiAgICB2YXIgY29sb3JzQXJyYXkgPSBOU011dGFibGVBcnJheS5hbGxvYygpLmluaXRXaXRoQ2FwYWNpdHkoMik7XG4gICAgY29sb3JzLmZvckVhY2goZnVuY3Rpb24gKGM6Q29sb3IpIHtcbiAgICAgIGNvbG9yc0FycmF5LmFkZE9iamVjdChpbnRlcm9wLnR5cGVzLmlkKGMuaW9zLkNHQ29sb3IpKTtcbiAgICB9KTtcbiAgICB2YXIgZ3JhZGllbnRMYXllciA9IENBR3JhZGllbnRMYXllci5sYXllcigpO1xuICAgIGdyYWRpZW50TGF5ZXIuY29sb3JzID0gY29sb3JzQXJyYXk7XG4gICAgZ3JhZGllbnRMYXllci5mcmFtZSA9IGlvc1ZpZXcuYm91bmRzO1xuICAgIGlvc1ZpZXcubGF5ZXIuaW5zZXJ0U3VibGF5ZXJBdEluZGV4KGdyYWRpZW50TGF5ZXIsIDApO1xuICB9XG59XG5cblxuZGVjbGFyZSBjb25zdCBpbmV0X250b2E6YW55O1xuZGVjbGFyZSBjb25zdCBnZXRpZmFkZHJzOmFueTtcbmRlY2xhcmUgY29uc3Qgc29ja2FkZHJfaW46YW55O1xuZGVjbGFyZSBjb25zdCBmcmVlaWZhZGRyczphbnk7XG5cbmZ1bmN0aW9uIGlwVG9TdHJpbmcoaW5BZGRyKSB7XG4gICAgaWYgKCFpbkFkZHIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbiA9PSBOVUxMJyk7XG4gICAgfVxuXG4gICAgaWYgKGluQWRkci5zX2FkZHIgPT09IDB4MDAwMDAwMDApIHtcbiAgICAgICAgcmV0dXJuICcqJztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTlNTdHJpbmcuc3RyaW5nV2l0aENTdHJpbmdFbmNvZGluZyhpbmV0X250b2EoaW5BZGRyKSwgMSkudG9TdHJpbmcoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJUEFkZHJlc3NPZkludGVyZmFjZSgkaW50ZXJmYWNlKSB7XG4gICAgdmFyIGFkZHJlc3MgPSAnLSc7XG4gICAgaWYgKCEkaW50ZXJmYWNlKSB7XG4gICAgICAgIHJldHVybiBhZGRyZXNzO1xuICAgIH1cblxuICAgIHZhciBpbnRlcmZhY2VzUHRyUHRyID0gbmV3IGludGVyb3AuUmVmZXJlbmNlKCk7XG5cbiAgICBpZiAoZ2V0aWZhZGRycyhpbnRlcmZhY2VzUHRyUHRyKSA9PT0gMCkge1xuICAgICAgICB2YXIgaW50ZXJmYWNlc1B0ciA9IGludGVyZmFjZXNQdHJQdHJbMF07XG4gICAgICAgIHZhciB0ZW1wX2FkZHJQdHIgPSBpbnRlcmZhY2VzUHRyO1xuXG4gICAgICAgIHdoaWxlICh0ZW1wX2FkZHJQdHIgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRlbXBfYWRkclB0clswXS5pZmFfYWRkclswXS5zYV9mYW1pbHkgPT09IDIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IE5TU3RyaW5nLnN0cmluZ1dpdGhVVEY4U3RyaW5nKHRlbXBfYWRkclB0clswXS5pZmFfbmFtZSkudG9TdHJpbmcoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gJGludGVyZmFjZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWZhX2FkZHJQdHIgPSB0ZW1wX2FkZHJQdHJbMF0uaWZhX2FkZHI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZmFfYWRkclB0ckFzU29ja0FkZHRyX2luID0gbmV3IGludGVyb3AuUmVmZXJlbmNlKHNvY2thZGRyX2luLCBpZmFfYWRkclB0cik7XG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgPSBpcFRvU3RyaW5nKGlmYV9hZGRyUHRyQXNTb2NrQWRkdHJfaW5bMF0uc2luX2FkZHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlbXBfYWRkclB0ciA9IHRlbXBfYWRkclB0clswXS5pZmFfbmV4dDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZyZWVpZmFkZHJzKGludGVyZmFjZXNQdHIpO1xuICAgIH1cbiAgICByZXR1cm4gYWRkcmVzcztcbn1cblxuIl19